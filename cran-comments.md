Fixes some bugs and exposes an internal function for better usability