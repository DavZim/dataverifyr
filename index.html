<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="The package allows you to define rules which can be applied to a
    dataset to check if the data conforms to your expectations.">
<title>a lightweight, flexible, and fast data validation package that can handle all datasizes • dataverifyr</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="a lightweight, flexible, and fast data validation package that can handle all datasizes">
<meta property="og:description" content="The package allows you to define rules which can be applied to a
    dataset to check if the data conforms to your expectations.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">dataverifyr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/DavZim/dataverifyr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="dataverifyr---a-lightweight-flexible-and-fast-data-validation-package-that-can-handle-all-datasizes">dataverifyr - a lightweight, flexible, and fast data validation package that can handle all datasizes<a class="anchor" aria-label="anchor" href="#dataverifyr---a-lightweight-flexible-and-fast-data-validation-package-that-can-handle-all-datasizes"></a>
</h1></div>
<!-- badges: start -->

<p>The goal of <code>dataverifyr</code> is to allow a wide variety of flexible data validation checks. That means, you can specify the rules/expressions in a yaml file, load it into R and compare any arbitrary dataset against it. The package is built in such a way, that you can use <code>base-R</code>, <code>dplyr</code>, <code>data.table</code>, <code>arrow</code> (both as an <code>arrow_table</code> as well as an <code><a href="https://arrow.apache.org/docs/r/reference/open_dataset.html" class="external-link">open_dataset()</a></code> connection), but also any <code>DBI</code>-compliant database (currently tested with <code>RSQLite</code> and <code>duckdb</code>).</p>
<p>The package is lightweight as all the heavy dependencies are Suggests-only, that means if you want to use <code>data.table</code> for the task, you don’t need to install the other packages (<code>arrow</code>, <code>DBI</code>, etc) unless you explicitly tell R to do so when installing the package.</p>
<p>The backend for your analysis is automatically chosen based on the input dataset as well as the available packages. By using the underlying technologies and handing all evaluation of code to the backends, this package can deal with all datasizes the backends can deal with.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of <code>dataverifyr</code> like so:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># development version</span></span>
<span><span class="co"># devtools::install_github("DavZim/dataverifyr")</span></span>
<span></span>
<span><span class="co"># CRAN release</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"dataverifyr"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>This is a basic example which shows you how to</p>
<ol style="list-style-type: decimal">
<li>create a rule-set manually</li>
<li>check if a dataset matches all given rules</li>
<li>save the rules to a yaml-file for better maintainability</li>
<li>load the rules from disk again</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavZim/dataverifyr" class="external-link">dataverifyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">rules</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ruleset.html">ruleset</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="reference/rule.html">rule</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">&gt;</span> <span class="fl">10</span> <span class="op">&amp;</span> <span class="va">mpg</span> <span class="op">&lt;</span> <span class="fl">30</span><span class="op">)</span>, <span class="co"># mpg goes up to 34</span></span>
<span>  <span class="fu"><a href="reference/rule.html">rule</a></span><span class="op">(</span><span class="va">cyl</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span>, <span class="co"># missing 6 cyl</span></span>
<span>  <span class="fu"><a href="reference/rule.html">rule</a></span><span class="op">(</span><span class="va">vs</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, allow_na <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print the rules</span></span>
<span><span class="va">rules</span></span>
<span><span class="co">#&gt; &lt;Verification Ruleset with 3 elements&gt;</span></span>
<span><span class="co">#&gt;   [1] 'Rule for: mpg' matching `mpg &gt; 10 &amp; mpg &lt; 30` (allow_na: FALSE)</span></span>
<span><span class="co">#&gt;   [2] 'Rule for: cyl' matching `cyl %in% c(4, 8)` (allow_na: FALSE)</span></span>
<span><span class="co">#&gt;   [3] 'Rule for: vs' matching `vs %in% c(0, 1)` (allow_na: TRUE)</span></span>
<span></span>
<span><span class="co"># check if the data matches our rules</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/check_data.html">check_data</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="va">rules</span><span class="op">)</span></span>
<span><span class="va">res</span></span>
<span><span class="co">#&gt;             name                expr allow_na negate tests pass fail warn error             time</span></span>
<span><span class="co">#&gt; 1: Rule for: mpg mpg &gt; 10 &amp; mpg &lt; 30    FALSE  FALSE    32   28    4            0.007985115 secs</span></span>
<span><span class="co">#&gt; 2: Rule for: cyl    cyl %in% c(4, 8)    FALSE  FALSE    32   25    7            0.003337860 secs</span></span>
<span><span class="co">#&gt; 3:  Rule for: vs     vs %in% c(0, 1)     TRUE  FALSE    32   32    0            0.000428915 secs</span></span>
<span></span>
<span><span class="co"># plot the results to get a better understanding of which rules are most often violated</span></span>
<span><span class="fu"><a href="reference/plot_res.html">plot_res</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-example-1.png" width="100%"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># save the rules to yml</span></span>
<span><span class="fu"><a href="reference/write_rules.html">write_rules</a></span><span class="op">(</span><span class="va">rules</span>, <span class="st">"example_rules.yaml"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="st">"example_rules.yaml"</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; - name: 'Rule for: mpg'</span></span>
<span><span class="co">#&gt;   expr: mpg &gt; 10 &amp; mpg &lt; 30</span></span>
<span><span class="co">#&gt;   allow_na: no</span></span>
<span><span class="co">#&gt;   negate: no</span></span>
<span><span class="co">#&gt;   index: 1</span></span>
<span><span class="co">#&gt; - name: 'Rule for: cyl'</span></span>
<span><span class="co">#&gt;   expr: cyl %in% c(4, 8)</span></span>
<span><span class="co">#&gt;   allow_na: no</span></span>
<span><span class="co">#&gt;   negate: no</span></span>
<span><span class="co">#&gt;   index: 2</span></span>
<span><span class="co">#&gt; - name: 'Rule for: vs'</span></span>
<span><span class="co">#&gt;   expr: vs %in% c(0, 1)</span></span>
<span><span class="co">#&gt;   allow_na: yes</span></span>
<span><span class="co">#&gt;   negate: no</span></span>
<span><span class="co">#&gt;   index: 3</span></span>
<span></span>
<span><span class="va">r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/write_rules.html">read_rules</a></span><span class="op">(</span><span class="st">"example_rules.yaml"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">rules</span>, <span class="va">r2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
</div>
<div class="section level1">
<h1 id="backends">Backends<a class="anchor" aria-label="anchor" href="#backends"></a>
</h1>
<p>At the moment the following backends are supported. Note that they are automatically chosen based on filetype (eg, when giving a <code><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">dplyr::tbl()</a></code> pointing to an <code>SQLite</code> database, the package will automatically choose <code>DBI</code>/<code>dplyr</code> for the task) and package availability.</p>
<table class="table">
<colgroup>
<col width="9%">
<col width="30%">
<col width="3%">
<col width="56%">
</colgroup>
<thead><tr class="header">
<th>Backend</th>
<th>Library</th>
<th>Status</th>
<th>Comment</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>base-R</code></td>
<td><code>base</code></td>
<td>✔️</td>
<td>When <code>data.table</code> or <code>dplyr</code> are installed, they are leveraged for higher performance, but if requried, the package works with base-r only</td>
</tr>
<tr class="even">
<td><code>dplyr</code></td>
<td><a href="https://dplyr.tidyverse.org/" class="external-link"><code>dplyr</code></a></td>
<td>✔️</td>
<td></td>
</tr>
<tr class="odd">
<td><code>data.table</code></td>
<td><a href="r-datatable.com"><code>data.table</code></a></td>
<td>✔️</td>
<td>Used as the default when installed and no special data-format is given.</td>
</tr>
<tr class="even">
<td>
<code>Table</code>/<code>ArrowTabular</code>
</td>
<td><a href="https://arrow.apache.org/docs/r/" class="external-link"><code>arrow</code></a></td>
<td>✔️</td>
<td>For example by using <code><a href="https://arrow.apache.org/docs/r/reference/Table.html" class="external-link">arrow::arrow_table()</a></code>
</td>
</tr>
<tr class="odd">
<td><code>FileSystemDataset</code></td>
<td><a href="https://arrow.apache.org/docs/r/" class="external-link"><code>arrow</code></a></td>
<td>✔️</td>
<td>For on disk storage using <code><a href="https://arrow.apache.org/docs/r/reference/open_dataset.html" class="external-link">arrow::open_dataset()</a></code>, very good for large datasets. See example below.</td>
</tr>
<tr class="even">
<td><code>sqlite</code></td>
<td>
<a href="https://rsqlite.r-dbi.org/" class="external-link"><code>RSQLite</code></a>/<a href="https://dbi.r-dbi.org/" class="external-link"><code>DBI</code></a>
</td>
<td>✔️</td>
<td>Note that missing values are converted to <code>0</code>s when using sqlite by default (<a href="https://stackoverflow.com/a/57746647/3048453" class="external-link">c.f. this SO answer</a>).</td>
</tr>
<tr class="odd">
<td><code>DuckDB</code></td>
<td>
<a href="https://duckdb.org/docs/api/r.html" class="external-link"><code>duckdb</code></a>/<a href="https://dbi.r-dbi.org/" class="external-link"><code>DBI</code></a>
</td>
<td>✔️</td>
<td></td>
</tr>
<tr class="even">
<td><code>postgreSQL</code></td>
<td><a href="https://rpostgres.r-dbi.org/" class="external-link"><code>RPostgres</code></a></td>
<td>❓</td>
<td>Not tested, but should work out-of-the-box through <a href="https://dbi.r-dbi.org/" class="external-link"><code>DBI</code></a>
</td>
</tr>
</tbody>
</table>
<div class="section level2">
<h2 id="larger-example-using-the-arrow-backend">Larger Example using the <code>arrow</code> backend<a class="anchor" aria-label="anchor" href="#larger-example-using-the-arrow-backend"></a>
</h2>
<p>For a more involved example, using a different backend, let’s say we have a larger dataset of taxi trips from NY (see also the official <a href="https://www.nyc.gov/site/tlc/about/tlc-trip-record-data.page" class="external-link">datasource</a>), that we have saved as a local arrow dataset (using parquet as a data format).</p>
<div class="section level3">
<h3 id="id_1-download-and-prepare-data">1 Download and Prepare Data<a class="anchor" aria-label="anchor" href="#id_1-download-and-prepare-data"></a>
</h3>
<p>First we prepare the data by downloading it and writing the dataset to <code>.parquet</code> files.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/apache/arrow/" class="external-link">arrow</a></span><span class="op">)</span></span>
<span><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"https://d37ci6vzurychx.cloudfront.net/trip-data/yellow_tripdata_2018-01.parquet"</span></span>
<span><span class="va">file</span> <span class="op">&lt;-</span> <span class="st">"yellow_tripdata_2018-01.parquet"</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="va">url</span>, <span class="va">file</span>, method <span class="op">=</span> <span class="st">"curl"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/file.info.html" class="external-link">file.size</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op">/</span> <span class="fl">1e6</span> <span class="co"># in MB</span></span>
<span><span class="co">#&gt; [1] 123.6685</span></span>
<span></span>
<span><span class="co"># quick check of the filesize</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://arrow.apache.org/docs/r/reference/read_parquet.html" class="external-link">read_parquet</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 8760687      19</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "VendorID"              "tpep_pickup_datetime"  "tpep_dropoff_datetime" "passenger_count"      </span></span>
<span><span class="co">#&gt;  [5] "trip_distance"         "RatecodeID"            "store_and_fwd_flag"    "PULocationID"         </span></span>
<span><span class="co">#&gt;  [9] "DOLocationID"          "payment_type"          "fare_amount"           "extra"                </span></span>
<span><span class="co">#&gt; [13] "mta_tax"               "tip_amount"            "tolls_amount"          "improvement_surcharge"</span></span>
<span><span class="co">#&gt; [17] "total_amount"          "congestion_surcharge"  "airport_fee"</span></span>
<span></span>
<span><span class="co"># write the dataset to disk</span></span>
<span><span class="fu"><a href="https://arrow.apache.org/docs/r/reference/write_dataset.html" class="external-link">write_dataset</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"nyc-taxi-data"</span><span class="op">)</span></span></code></pre></div>
<p>Note that the above code is only used to get the data, the actual <code>dataverifyr</code> code is below.</p>
</div>
<div class="section level3">
<h3 id="id_2-create-rules-in-yaml">2 Create Rules in <code>yaml</code>
<a class="anchor" aria-label="anchor" href="#id_2-create-rules-in-yaml"></a>
</h3>
<p>Next, we can create some rules that we want to see if our data conforms to. As we saw earlier, we can create the rules in R using the <code>rules()</code> and <code><a href="reference/ruleset.html">ruleset()</a></code> functions, there is however, the (in my case) preferred option to separate the code from the rules by writing the rules in a separate yaml file and read them into R.</p>
<p>First we display the hand-written contents of the <code>nyc_data_rules.yaml</code> file.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">'Rule for: passenger_count'</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">expr</span><span class="kw">:</span><span class="at"> passenger_count &gt;= 0 &amp; passenger_count &lt;= 10</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">allow_na</span><span class="kw">:</span><span class="at"> </span><span class="ch">no</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">negate</span><span class="kw">:</span><span class="at"> </span><span class="ch">no</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">index</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">'Rule for: trip_distance'</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">expr</span><span class="kw">:</span><span class="at"> trip_distance &gt;= 0 &amp; trip_distance &lt;= 1000</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">allow_na</span><span class="kw">:</span><span class="at"> </span><span class="ch">no</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">negate</span><span class="kw">:</span><span class="at"> </span><span class="ch">no</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">index</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">'Rule for: payment_type'</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">expr</span><span class="kw">:</span><span class="at"> payment_type %in% c(0, 1, 2, 3, 4)</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">allow_na</span><span class="kw">:</span><span class="at"> </span><span class="ch">no</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">negate</span><span class="kw">:</span><span class="at"> </span><span class="ch">no</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">index</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span></code></pre></div>
<p>Then, we can load and display the rules:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rules</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/write_rules.html">read_rules</a></span><span class="op">(</span><span class="st">"nyc_data_rules.yaml"</span><span class="op">)</span></span>
<span><span class="va">rules</span></span>
<span><span class="co">#&gt; &lt;Verification Ruleset with 3 elements&gt;</span></span>
<span><span class="co">#&gt;   [1] 'Rule for: passenger_count' matching `passenger_count &gt;= 0 &amp; passenger_count &lt;= 10` (allow_na: FALSE)</span></span>
<span><span class="co">#&gt;   [2] 'Rule for: trip_distance' matching `trip_distance &gt;= 0 &amp; trip_distance &lt;= 1000` (allow_na: FALSE)</span></span>
<span><span class="co">#&gt;   [3] 'Rule for: payment_type' matching `payment_type %in% c(0, 1, 2, 3, 4)` (allow_na: FALSE)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_3-verify-that-the-data-matches-the-given-rules">3 Verify that the Data matches the given Rules<a class="anchor" aria-label="anchor" href="#id_3-verify-that-the-data-matches-the-given-rules"></a>
</h3>
<p>Now we can check if the data follows our rules or if we have unexpected data points:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># open the dataset </span></span>
<span><span class="va">ds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://arrow.apache.org/docs/r/reference/open_dataset.html" class="external-link">open_dataset</a></span><span class="op">(</span><span class="st">"nyc-taxi-data/"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># perform the data validation check</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/check_data.html">check_data</a></span><span class="op">(</span><span class="va">ds</span>, <span class="va">rules</span><span class="op">)</span></span>
<span><span class="va">res</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 10</span></span>
<span><span class="co">#&gt;   name                      expr              allow…¹ negate   tests    pass  fail warn  error time </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                     &lt;chr&gt;             &lt;lgl&gt;   &lt;lgl&gt;    &lt;int&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;drt&gt;</span></span>
<span><span class="co">#&gt; 1 Rule for: passenger_count passenger_count … FALSE   FALSE  8760687 8760687     0 ""    ""    0.56…</span></span>
<span><span class="co">#&gt; 2 Rule for: trip_distance   trip_distance &gt;=… FALSE   FALSE  8760687 8760686     1 ""    ""    0.43…</span></span>
<span><span class="co">#&gt; 3 Rule for: payment_type    payment_type %in… FALSE   FALSE  8760687 8760687     0 ""    ""    0.36…</span></span>
<span><span class="co">#&gt; # … with abbreviated variable name ¹​allow_na</span></span>
<span></span>
<span><span class="fu"><a href="reference/plot_res.html">plot_res</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-taxi3-1.png" width="100%"></p>
<p>Using the power of <code>arrow</code>, we were able to scan 8+mln observations for three rules in about 1.5 seconds (YMMV). As we can see from the results, there is one unexpected value, lets quickly investigate using the [<code><a href="reference/filter_fails.html">filter_fails()</a></code>] function, which filters a dataset for the failed rule matches</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/filter_fails.html">filter_fails</a></span><span class="op">(</span><span class="va">ds</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># only select a couple of variables for brevity</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">tpep_pickup_datetime</span>, <span class="va">tpep_dropoff_datetime</span>, <span class="va">trip_distance</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span><span class="co">#&gt;   tpep_pickup_datetime tpep_dropoff_datetime trip_distance</span></span>
<span><span class="co">#&gt;   &lt;dttm&gt;               &lt;dttm&gt;                        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 2018-01-30 12:41:02  2018-01-30 12:42:09         189484.</span></span></code></pre></div>
<p>As we can see, this is probably a data error (a trip distance of 190k miles in 1 minute seems - ehm stellar…).</p>
</div>
</div>
<div class="section level2">
<h2 id="using-a-dbi-backend">Using a <code>DBI</code> Backend<a class="anchor" aria-label="anchor" href="#using-a-dbi-backend"></a>
</h2>
<p>If you have a <code>SQLite</code> or <code>duckdb</code> database, you can use the package like this</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org" class="external-link">DBI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># connect to a duckdb database</span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">duckdb</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/duckdb/man/duckdb.html" class="external-link">duckdb</a></span><span class="op">(</span><span class="st">"duckdb-database.duckdb"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># for demo purposes write the data once</span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbWriteTable.html" class="external-link">dbWriteTable</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"mtcars"</span>, <span class="va">mtcars</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a tbl connection, which can be used in the checks</span></span>
<span><span class="va">tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"mtcars"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create rules</span></span>
<span><span class="va">rules</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ruleset.html">ruleset</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="reference/rule.html">rule</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">&gt;</span> <span class="fl">10</span> <span class="op">&amp;</span> <span class="va">mpg</span> <span class="op">&lt;</span> <span class="fl">40</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="reference/rule.html">rule</a></span><span class="op">(</span><span class="va">cyl</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="reference/rule.html">rule</a></span><span class="op">(</span><span class="va">vs</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, allow_na <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check rules</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/check_data.html">check_data</a></span><span class="op">(</span><span class="va">tbl</span>, <span class="va">rules</span><span class="op">)</span></span>
<span><span class="va">res</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 10</span></span>
<span><span class="co">#&gt;   name          expr                allow_na negate tests  pass  fail warn  error time           </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;         &lt;chr&gt;               &lt;lgl&gt;    &lt;lgl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;drtn&gt;         </span></span>
<span><span class="co">#&gt; 1 Rule for: mpg mpg &gt; 10 &amp; mpg &lt; 40 FALSE    FALSE     32    32     0 ""    ""    0.04341698 secs</span></span>
<span><span class="co">#&gt; 2 Rule for: cyl cyl %in% c(4, 6, 8) FALSE    FALSE     32    32     0 ""    ""    0.03063011 secs</span></span>
<span><span class="co">#&gt; 3 Rule for: vs  vs %in% c(0, 1)     TRUE     FALSE     32    32     0 ""    ""    0.03730798 secs</span></span>
<span></span>
<span><span class="co"># lastly disconnect from the database again</span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">con</span>, shutdown <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level1">
<h1 id="alternative-data-validation-r-libraries">Alternative Data Validation R Libraries<a class="anchor" aria-label="anchor" href="#alternative-data-validation-r-libraries"></a>
</h1>
<p>If this library is not what you are looking for, the following might be good alternatives to validate your data:</p>
<ul>
<li><a href="https://rich-iannone.github.io/pointblank/" class="external-link"><code>pointblank</code></a></li>
<li><a href="https://github.com/data-cleaning/validate" class="external-link"><code>validate</code></a></li>
<li><a href="https://github.com/Appsilon/data.validator" class="external-link"><code>data.validator</code></a></li>
</ul>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/DavZim/dataverifyr/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/DavZim/dataverifyr/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing dataverifyr</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>David Zimmermann-Kollenda <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-pkg.org/pkg/dataverifyr" class="external-link"><img src="https://www.r-pkg.org/badges/version/dataverifyr"></a></li>
<li><a href="https://github.com/DavZim/dataverifyr/actions" class="external-link"><img src="https://github.com/DavZim/dataverifyr/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://www.r-pkg.org/pkg/dataverifyr" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/dataverifyr" alt="CRAN RStudio mirror downloads"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by David Zimmermann-Kollenda.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
